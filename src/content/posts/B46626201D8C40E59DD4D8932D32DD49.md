---
title: メッシュマップ（meshmap）の使いかた
pubDate: 2023-08-01T16:07:41.000Z
updatedDate: 2025-02-07T18:21:36.000Z
tags:
  - meshmap
isDraft: false
description: >-
  メッシュマップはメッシュに区切られた地図です。各メッシュはA1,B3など座標で区切られます。観察場所から離れたところに見つけた鳥の位置を指定できます。座標やメッシュサイズは設定可能でき、緯度・経度を知られたくない場合の位置情報のやり取りにも便利です。
category: toriR
heroImage: edit_meshmap_meshmapx1200.png
---



---

### 履歴

| Version | date         | 内容                                         |
| ----    | ------       | ---------------------                        |
| V0.3    | [2023-08-07] | 説明追加、傾きなし機能を追加、バグフィックス |
| V0.2    | [2023-08-01] | バグフィックス                               |
| V0.1    | [2023-08-01] | 新規作成                                     |

---


![edit meshの作画例](https://object-storage.tyo2.conoha.io/v1/nc_2520d9a1_blog-astro-assets/blog-astro-assets/edit_meshmap_meshmapx1200.png){.img-fluid}

## 構成

webアプリは２つあり(A)メッシュマップを作るedit meshmapと(B)メッシュマップ上に位置を登録するmeshmapの２つがあります。


| #    | 名称         | 機能                                                         | URL                                              |
| ---- | ------------ | ------------------------------------------------------------ | ------------------------------------------------ |
| A    | edit_meshmap | メッシュマップの設定。このメッシュマップで作ったURL/QR-codeをユーザに公開することで | login>dashboard>edit_meshmap                     |
| B    | meshmap      | 現地でメッシュマップを用いてマカーの座標を取得します         | edit_meshmapに表示される<br>QRcodeも表示されます |


meshmapの編集は[ログイン]("/cgi/login.cgi")後、dashboardの中のedit meshmapを選んでください。

球である地球を２次元平面に変換しているのでどうしてもずれが生じます。そのため、緯度経度から一旦[こちら](https://zenn.dev/tonbiwing/articles/0a8c2a130058e0)のサイトを参考に直交２次元に変換しています。


## 用語

| 用語     |                                                              | 例          |
| -------- | ------------------------------------------------------------ | ----------- |
| meshmap  | 地図の上に座標を持つメッシュ情報を吹かした地図               |             |
| 座標     | メッシュマップ上の位置を示す文字列。２次元直行系で英数字で表されます。英字はZ以降は２文字でAA,ABとインクリメントします。</br>メッシュの範囲外は数字ならマイナスで、英字ならZZからZY,Z...の２文字でデクリメントします。 | A0, B1,C-11 |
| マーカー | 地図上をクリックすることで現れる位置表示記号で、メッシュが設定されているばメッシュ座標も表示されます。 |             |



## A)  edit mashmapの使い方

### 基本的な使い方

流れは次のとおりです。

1. マップの新規作成
2. メッシュマップの3点を指示
3. メッシュ生成とデータの保存

基本的な動作は以下のようになっています。

- 地図上でクリックするとポインタの緯度経度の欄に代入されます。
- 緯度経度は10進数と度分秒(DMS)の表示方法があり、ボタンを押すことで相互に変換可能です。
- DMSは度は（°）、分は（'）、秒は（"）をつけてください。

<img src="https://object-storage.tyo2.conoha.io/v1/nc_2520d9a1_blog-astro-assets/blog-astro-assets/blog-images/B46626201D8C40E59DD4D8932D32DD49/edit_meshmap_latlng_DMSx1200.png" alt="ポインタの緯度経度、DMS（度、分、秒）と相互変換" style="zoom:50%;" />

- 地図上ではマウスのセンタースクロールで拡大縮小します。
- メッシュの座標はP0を基本とします。開始文字と開始数字を指定できます。
- メッシュマップのフォントサイズ、線の色、文字の色を変更することができます。
- 座標の文字は全メッシュに表示することも片辺のみに表示することもできます。
- "clear"ボタンはメッシュマップを非表示します。
- "reset"ボタンは全パラメータを初期値に戻します。表示位置、P0,P1,P2は指定座標の原点になります。

### 1. メッシュマップの作成（表の編集）

- マップのメッシュと座標系、mapIPの設定を行います。
- マップ名称がユーザのmeshmapに表示されます。
- 座標系は国内は１９箇所設定されており、県別、地域別になっています。[こちら](https://www.gsi.go.jp/sokuchikijun/jpc.html)をご覧ください。

<img src="https://object-storage.tyo2.conoha.io/v1/nc_2520d9a1_blog-astro-assets/blog-astro-assets/blog-images/B46626201D8C40E59DD4D8932D32DD49/edit_meshmapx1200.png" alt="meshmapの編集（表）" style="zoom:50%;" />

- マップ名称は必須です。半角文字は全角文字に変換されます（セキュリティ担保のため）
- 地図は標準地図の他、淡色地図、航空写真を選べます。
- map IDは全世界で唯一の番号が自動で割り当てられ変更はできません。

### 2. メッシュマップの角3点を指示

- メッシュの座標はメッシュの中心入りの緯度経度です。そのためメッシュ中心にマーカーP0、P1、P2は中心になっています。
- P0は原点です。地図をクリックすると"ポインタ"の座標に緯度と経度が代入されます。
- この数値をボタン"set P0"をクリックすることで取り込まれます。
- P1はP0からの線分をメッシュの一辺となる点で、"set P1"を押すとポインタの緯度経度が取り込まれます。メッシュサイズに丸められます。このメッシュは英文字がインクリメントされます。例"A"の次は"B"です。
- P2-P0、P1とP0の距離は2km以内です。
- P2はP0-P1の線分から垂直方向のメッシュ位置でメッシュサイズで丸められます。数字がインクリメントされます。
- "メッシュ生成"ボタンを押すとメッシュが表示されます。"保存"ボタンが押されるまでサーバに登録されません。
- メッシュマップの座標の開始文字と開始数字、フォントサイズ、色の変更した後は"メッシュ生成"ボタンを押してください。更新されます。
- "保存"ボタンで設定値がサーバに登録されます。ズーム率も保存されます。


## B) meshmapの使い方

<img src="https://object-storage.tyo2.conoha.io/v1/nc_2520d9a1_blog-astro-assets/blog-astro-assets/blog-images/B46626201D8C40E59DD4D8932D32DD49/meshmap_menux1200.png" alt="メッシュのメニュー" style="zoom:75%;" />

### 概要

- 現場でスマホで座標を取得できます。マーカーを地図に落とすとその場所の緯度経度と座標がマップ名と時刻と共にスマホに保存されます。
- メッシュマップの変更はできません。
- 複数のメンバがメッシュの場所の付近の座標を取得することができます。
- マーカーリストは編集できないので取り込んだ後に時刻を目安にするなどして編集してください。

### 使い方

- 複数のメンバが現地で別々に観察し、各々が例えば鳴いた鳥の場所をメッシュマップ上にマーキングすることで囀りのソングエリアを作成することができます。

### メニュー

- メッシュの表示非表示


<img src="https://object-storage.tyo2.conoha.io/v1/nc_2520d9a1_blog-astro-assets/blog-astro-assets/blog-images/B46626201D8C40E59DD4D8932D32DD49/meshmap_displaiedx1200.png" alt="メッシュの表示例" style="zoom: 30%;" />


- 現在位置に移動、Undo（初期位置に戻る）
- マーカー情報の削除
  - スマホに保存されているマーカー情報を削除し、マーカーを消します。
- マーカー情報の表示とコピー
  - スマホに文字列がコピーされます。メールの本文やLINEにペーストすることで情報を取り出せます。

<img src="https://object-storage.tyo2.conoha.io/v1/nc_2520d9a1_blog-astro-assets/blog-astro-assets/blog-images/B46626201D8C40E59DD4D8932D32DD49/meshmap_CopyDatax1200.png" alt="マーカー情報の表示とコピー" style="zoom:30%;" />


- コピー内容の例

```
越前市八ッ杉, 2023-08-01, 15:21:06, 35.88859510585916, 136.30972031503916, H17
越前市八ッ杉, 2023-08-01, 15:21:08, 35.88739559303906, 136.31079319864511, B24
越前市八ッ杉, 2023-08-01, 15:36:13, 35.88678143326892, 136.30960464477542, ZX19
```



## 既知のバグ＆インプリしたい事項

- [x] 開始文字と開始数字が、指示と違う。-> 修正しました[v0.2]
- [x] 保存を押した時に、「mapを選択してください」の、mapがどこにあるか不明。
- [x] P0-P1の緯度経度に対する傾きを無しにする
- [ ] P0-P1の緯度経度に対する角度を数値指示できるようにする。
- [ ] meshmapで登録ボタンを別にする。
- [ ] meshmapで観察した中身を事前に登録してセレクタで選択できるようにする。
- [ ] マルチデバイス対応で地図のサイズを自動で変えること。

## その他

座標変換のjavascriptの作者のTobiWingさんに[バッジを送りました](https://twitter.com/TorirLab/status/1686268533985132544?s=20)。

## 履歴

- 2023-08-01 v0.2 座標の文字と数字を直しました。
- 2023-08-01 v0.1新規作成
